define(["exports"],function(t){"use strict";function i(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function e(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}var r=function t(e,n){i(this,t),this.path=e,this.width=n.width,this.height=n.height,this.area=this.width*this.height},s=function t(e,n){i(this,t),this.x=e,this.y=n},o=function(){function t(e,n,r,s,o){i(this,t),this.path=o,this.x=e,this.y=n,this.width=r,this.height=s,this.left=e,this.top=n,this.right=this.left+r,this.bottom=this.top+s,this.centerX=(this.left+this.right)/2,this.centerY=(this.top+this.bottom)/2}return n(t,[{key:"isCollided",value:function(t){return Math.abs(this.centerX-t.centerX)<(this.width+t.width)/2&&Math.abs(this.centerY-t.centerY)<(this.height+t.height)/2}}]),t}(),h=function(){function t(){i(this,t),this.points=[],this.regions=[],this.initPoints()}return n(t,[{key:"initPoints",value:function(){var t=new s(0,0);this.points.push(t)}},{key:"getPossibleRegions",value:function(t,i,e){var n=this,r=[];return this.points.forEach(function(s){var h=new o(s.x,s.y,t,i,e),a=n.regions.length;if(0===a)r.push(h);else{for(var c=!0,u=0;u<a;u++)n.regions[u].isCollided(h)&&(c=!1);c&&r.push(h)}}),r}},{key:"getSmallestAreaRegion",value:function(t,i,e){var n,r=this,s=this.getPossibleRegions(t,i,e),o=Number.MAX_VALUE;return s.forEach(function(t){var i=r.getTotalAreaOfRegions(t);o>i&&(o=i,n=t)}),n}},{key:"getTotalAreaOfRegions",value:function(t){return this.getTotalWidthOfRegions(t)*this.getTotalHeightOfRegions(t)}},{key:"getTotalWidthOfRegions",value:function(t){var i=t?t.right:0;return this.regions.forEach(function(t){i=Math.max(i,t.right)}),i}},{key:"getTotalHeightOfRegions",value:function(t){var i=t?t.bottom:0;return this.regions.forEach(function(t){i=Math.max(i,t.bottom)}),i}}]),t}(),a=require("fs"),c=require("path"),u=require("images"),f=require("log4js").getLogger("ngo-sprite");f.level="info",t.main=function(t){if(t){var i=a.readdirSync(t).filter(function(t){return"sprite.png"!=t}).filter(function(t){var i=t.substring(t.indexOf(".")).toLowerCase();return".bmp"==i||".png"==i||".gif"==i||".jpg"==i||".jpeg"==i}).map(function(i){return c.join(t,i)}).filter(function(t){return a.statSync(t).isFile()}).map(function(t){return new r(t,u(t).size())});i.sort(function(t,i){return t.area<i.area});var e=new h;i.forEach(function(t,i){var n=e.getSmallestAreaRegion(t.width,t.height,t.path);if(n){e.regions.push(n),e.points.push(new s(n.right,n.top)),e.points.push(new s(n.left,n.bottom));var r=e.points.findIndex(function(t){return t.x===n.x&&t.y===n.y});e.points.splice(r,1)}});var n=u(e.getTotalWidthOfRegions(),e.getTotalHeightOfRegions());e.regions.forEach(function(t){n.draw(u(t.path),t.x,t.y)}),n.save(c.join(t,"sprite.png"));var o="";e.regions.forEach(function(t){var i="{".concat(t.path,",background-position: -").concat(t.x,"px -").concat(t.y,"px,width:").concat(t.width,"px,height:").concat(t.height,"px}\n");o+=i}),a.writeFileSync(c.join(t,"./sprite-css.txt"),o),f.info("generate sprite image success,it has been saved in ".concat(t,"/sprite.png")),f.info("generate css success,it has been saved in ".concat(t,"/sprite-css.txt"))}else f.error("please input image dir.")},Object.defineProperty(t,"__esModule",{value:!0})});
